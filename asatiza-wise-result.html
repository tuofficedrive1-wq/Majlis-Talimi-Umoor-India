<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Asatiza Result</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&display=swap" rel="stylesheet">
    <style>
        .urdu-font { font-family: 'Noto Nastaliq Urdu', serif; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .inner-table input { width: 100%; border: 1px solid #e2e8f0; text-align: center; font-size: 12px; padding: 2px; }
        .teacher-row:nth-child(even) { background-color: #f8fafc; }
    </style>
</head>
<body class="bg-gray-100 p-2 sm:p-6">

    <div class="max-w-7xl mx-auto bg-white shadow-xl rounded-lg overflow-hidden">
        <div class="bg-teal-700 p-4 text-white flex justify-between items-center">
            <h1 class="text-xl font-bold urdu-font">اساتذہ وائز تفصیلی رزلٹ فارم</h1>
            <div class="text-left">
                <span id="jamia-name-head" class="bg-teal-800 px-3 py-1 rounded text-sm font-bold"></span>
            </div>
        </div>

        <div class="p-4">
            <div class="flex flex-wrap gap-4 mb-6 bg-teal-50 p-4 rounded-lg border border-teal-100">
                <div class="w-full sm:w-auto">
                    <label class="block text-xs font-bold text-teal-800 mb-1">رپورٹنگ مہینہ</label>
                    <input type="month" id="report-month-selector" class="p-2 border border-teal-300 rounded outline-none focus:ring-2 focus:ring-teal-500">
                </div>
                <div class="w-full sm:w-auto">
                    <label class="block text-xs font-bold text-teal-800 mb-1">امتحان کی قسم</label>
                    <select class="p-2 border border-teal-300 rounded outline-none focus:ring-2 focus:ring-teal-500 font-bold">
                        <option>ششماہی (Half Year)</option>
                        <option>سالانہ (Annual)</option>
                    </select>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead class="bg-gray-200 text-sm">
                        <tr>
                            <th class="border border-gray-300 p-2 w-10">نمبر</th>
                            <th class="border border-gray-300 p-2 w-48">نام استاد / درجہ</th>
                            <th class="border border-gray-300 p-2">پیریڈز کی تفصیل (مضمون، طلبہ، رزلٹ)</th>
                            <th class="border border-gray-300 p-2 w-24">مجموعی فیصد %</th>
                        </tr>
                    </thead>
                    <tbody id="main-teacher-body">
                        </tbody>
                </table>
            </div>

            <div class="mt-4 flex gap-2">
                <button onclick="addTeacherRow()" class="bg-gray-800 text-white px-4 py-2 rounded shadow hover:bg-gray-700 transition">
                    + نیا استاد شامل کریں
                </button>
            </div>

            <div class="mt-8 flex justify-center border-t pt-6">
                <button class="bg-teal-600 text-white px-10 py-3 rounded-full font-bold text-lg hover:bg-teal-700 shadow-lg transform active:scale-95 transition">
                    ڈیٹا محفوظ کریں (Submit Result)
                </button>
            </div>
        </div>
    </div>

    <script>
        let teacherCount = 0;

        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            document.getElementById('jamia-name-head').innerText = params.get('jamia') || 'Jamia Name';
            
            // Set Current Month
            const now = new Date();
            document.getElementById('report-month-selector').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            
            // Default 3 teachers add karein
            for(let i=0; i<3; i++) addTeacherRow();
        });

        function addTeacherRow() {
            teacherCount++;
            const tbody = document.getElementById('main-teacher-body');
            const tr = document.createElement('tr');
            tr.className = "teacher-row border-b border-gray-300";
            
            tr.innerHTML = `
                <td class="border border-gray-300 p-2 text-center font-bold">${teacherCount}</td>
                <td class="border border-gray-300 p-2">
                    <input type="text" placeholder="استاد کا نام" class="w-full mb-2 p-1 border rounded font-bold text-teal-900">
                    <input type="text" placeholder="درجہ / کلاس" class="w-full p-1 border rounded text-sm">
                </td>
                <td class="border border-gray-300 p-2">
                    <table class="w-full inner-table">
                        <thead class="bg-gray-50">
                            <tr>
                                <th>مضمون</th>
                                <th class="w-16">کل طلبہ</th>
                                <th class="w-16">شریک</th>
                                <th class="w-16">کامیاب</th>
                                <th class="w-20">فیصد</th>
                            </tr>
                        </thead>
                        <tbody id="periods-${teacherCount}">
                            ${Array(4).fill().map(() => createPeriodRow(teacherCount)).join('')}
                        </tbody>
                    </table>
                    <button onclick="addPeriodRow(${teacherCount})" class="text-[10px] text-teal-600 mt-1 font-bold">+ پیریڈ شامل کریں</button>
                </td>
                <td class="border border-gray-300 p-2 text-center">
                    <div id="total-percent-${teacherCount}" class="text-lg font-bold text-teal-700">0%</div>
                </td>
            `;
            tbody.appendChild(tr);
        }

        function createPeriodRow(tId) {
            return `
                <tr>
                    <td><input type="text" placeholder="مضمون"></td>
                    <td><input type="number" class="total-std" oninput="calculateTeacher(${tId})"></td>
                    <td><input type="number" class="appeared-std" oninput="calculateTeacher(${tId})"></td>
                    <td><input type="number" class="passed-std" oninput="calculateTeacher(${tId})"></td>
                    <td><input type="text" class="period-perc bg-gray-100" readonly></td>
                </tr>`;
        }

        function addPeriodRow(tId) {
            const pBody = document.getElementById(`periods-${tId}`);
            const tr = document.createElement('tr');
            tr.innerHTML = createPeriodRow(tId);
            pBody.appendChild(tr);
        }

        function calculateTeacher(tId) {
            const pBody = document.getElementById(`periods-${tId}`);
            const rows = pBody.querySelectorAll('tr');
            let totalSum = 0;
            let passSum = 0;

            rows.forEach(row => {
                const total = parseFloat(row.querySelector('.total-std').value) || 0;
                const pass = parseFloat(row.querySelector('.passed-std').value) || 0;
                const percField = row.querySelector('.period-perc');

                if(total > 0) {
                    const p = (pass / total) * 100;
                    percField.value = p.toFixed(1) + '%';
                    totalSum += total;
                    passSum += pass;
                } else {
                    percField.value = '';
                }
            });

            const finalLabel = document.getElementById(`total-percent-${tId}`);
            if(totalSum > 0) {
                const finalPerc = (passSum / totalSum) * 100;
                finalLabel.innerText = finalPerc.toFixed(1) + '%';
            } else {
                finalLabel.innerText = '0%';
            }
        }
    </script>
</body>
</html>
