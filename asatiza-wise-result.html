<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Asatiza Result</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&display=swap" rel="stylesheet">
    <style>
        .urdu-font { font-family: 'Noto Nastaliq Urdu', serif; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .inner-table input { width: 100%; border: 1px solid #e2e8f0; text-align: center; font-size: 12px; padding: 4px; border-radius: 4px; }
        .inner-table input:focus { border-color: #0d9488; outline: none; background: #f0fdfa; }
        .teacher-row:nth-child(even) { background-color: #f9fafb; }
        th { font-weight: bold; color: #374151; }
    </style>
</head>
<body class="bg-gray-100 p-2 sm:p-6">

    <div class="max-w-7xl mx-auto bg-white shadow-xl rounded-lg overflow-hidden border-t-4 border-teal-700">
        <div class="bg-white p-4 flex justify-between items-center border-b">
            <h1 class="text-xl font-bold urdu-font text-teal-800">اساتذہ وائز تعلیمی رپورٹ</h1>
            <div id="jamia-name-head" class="text-teal-600 font-bold border-b-2 border-teal-600"></div>
        </div>

        <div class="p-4">
            <div class="flex flex-wrap gap-4 mb-6 bg-gray-50 p-4 rounded-lg">
                <div class="w-full sm:w-auto">
                    <label class="block text-xs font-bold text-gray-500 mb-1">رپورٹنگ مہینہ</label>
                    <input type="month" id="report-month-selector" class="p-2 border rounded outline-none focus:ring-2 focus:ring-teal-500">
                </div>
                <div class="w-full sm:w-auto">
                    <label class="block text-xs font-bold text-gray-500 mb-1">امتحان</label>
                    <select class="p-2 border rounded outline-none focus:ring-2 focus:ring-teal-500 font-bold">
                        <option>ششماہی (Half Year)</option>
                        <option>سالانہ (Annual)</option>
                    </select>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead class="bg-teal-50 text-sm">
                        <tr>
                            <th class="border border-gray-300 p-2 w-10">نمبر</th>
                            <th class="border border-gray-300 p-2 w-48">نام استاد</th>
                            <th class="border border-gray-300 p-2 text-right px-4">تعلیمی تفصیلات (کلاس و مضمون وار)</th>
                            <th class="border border-gray-300 p-2 w-28">مجموعی فیصد %</th>
                        </tr>
                    </thead>
                    <tbody id="main-teacher-body"></tbody>
                </table>
            </div>

            <button onclick="addTeacherRow()" class="mt-4 bg-gray-800 text-white px-5 py-2 rounded-lg text-sm hover:bg-gray-700 transition">
                + نیا استاد شامل کریں
            </button>

            <div class="mt-10 flex justify-center border-t pt-8">
                <button class="bg-teal-600 text-white px-12 py-3 rounded-xl font-bold text-lg hover:bg-teal-700 shadow-lg transform active:scale-95 transition">
                    ڈیٹا محفوظ کریں (Submit)
                </button>
            </div>
        </div>
    </div>

    <script>
        let teacherCount = 0;

        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            document.getElementById('jamia-name-head').innerText = params.get('jamia') || 'جامعہ کا نام';
            
            const now = new Date();
            document.getElementById('report-month-selector').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            
            for(let i=0; i<3; i++) addTeacherRow();
        });

        function addTeacherRow() {
            teacherCount++;
            const tbody = document.getElementById('main-teacher-body');
            const tr = document.createElement('tr');
            tr.className = "teacher-row border-b border-gray-300";
            
            tr.innerHTML = `
                <td class="border border-gray-300 p-2 text-center font-bold text-gray-400">${teacherCount}</td>
                <td class="border border-gray-300 p-2 align-top">
                    <input type="text" placeholder="نام استاد" class="w-full p-2 border rounded font-bold text-gray-800">
                </td>
                <td class="border border-gray-300 p-2">
                    <table class="w-full inner-table">
                        <thead class="bg-gray-100">
                            <tr class="text-[11px]">
                                <th class="w-24">درجہ / کلاس</th>
                                <th>مضمون</th>
                                <th class="w-16">کل طلبہ</th>
                                <th class="w-16">کامیاب</th>
                                <th class="w-20">فیصد</th>
                            </tr>
                        </thead>
                        <tbody id="periods-${teacherCount}">
                            ${createInitialPeriodRows(teacherCount)}
                        </tbody>
                    </table>
                    <button onclick="addPeriodRow(${teacherCount})" class="text-[11px] text-teal-600 mt-2 font-bold hover:underline">+ پیریڈ شامل کریں</button>
                </td>
                <td class="border border-gray-300 p-2 text-center align-middle">
                    <div id="total-percent-${teacherCount}" class="text-xl font-bold text-teal-700 bg-teal-50 py-2 rounded">0%</div>
                </td>
            `;
            tbody.appendChild(tr);
        }

        function createInitialPeriodRows(tId) {
            let rows = '';
            for(let i=0; i<4; i++) { rows += createPeriodRow(tId); }
            return rows;
        }

        function createPeriodRow(tId) {
            return `
                <tr>
                    <td><input type="text" placeholder="کلاس"></td>
                    <td><input type="text" placeholder="مضمون"></td>
                    <td><input type="number" class="total-std" oninput="calculateTeacher(${tId})"></td>
                    <td><input type="number" class="passed-std" oninput="calculateTeacher(${tId})"></td>
                    <td><input type="text" class="period-perc bg-gray-50 text-teal-600 font-bold" readonly></td>
                </tr>`;
        }

        function addPeriodRow(tId) {
            const pBody = document.getElementById(`periods-${tId}`);
            const tr = document.createElement('tr');
            tr.innerHTML = createPeriodRow(tId);
            pBody.appendChild(tr);
        }

        function calculateTeacher(tId) {
            const pBody = document.getElementById(`periods-${tId}`);
            const rows = pBody.querySelectorAll('tr');
            let totalSum = 0;
            let passSum = 0;

            rows.forEach(row => {
                const total = parseFloat(row.querySelector('.total-std').value) || 0;
                const pass = parseFloat(row.querySelector('.passed-std').value) || 0;
                const percField = row.querySelector('.period-perc');

                if(total > 0) {
                    const p = (pass / total) * 100;
                    percField.value = p.toFixed(1) + '%';
                    totalSum += total;
                    passSum += pass;
                } else {
                    percField.value = '';
                }
            });

            const finalLabel = document.getElementById(`total-percent-${tId}`);
            if(totalSum > 0) {
                const finalPerc = (passSum / totalSum) * 100;
                finalLabel.innerText = finalPerc.toFixed(1) + '%';
            } else {
                finalLabel.innerText = '0%';
            }
        }
    </script>
</body>
</html>
