<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Academic Inspector</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
body{font-family:Poppins;background:#f1f5f9}
.card{background:white;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.tab-btn{padding:8px 16px;border-radius:8px;font-weight:600}
.tab-active{background:#4f46e5;color:white}
</style>
</head>
<body>

<!-- NAV -->
<div class="bg-white shadow p-4 flex justify-between">
<div class="font-bold text-xl text-gray-800">Academic Inspector</div>
<button onclick="handleLogout()" class="bg-red-500 text-white px-4 py-2 rounded">Logout</button>
</div>

<main class="max-w-7xl mx-auto p-6">

<!-- SUMMARY SECTION -->
<div id="summary-section">

<!-- PROFILE HEADER -->
<div class="card p-6 mb-6 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">

<!-- LEFT PROFILE -->
<div class="flex items-center gap-5">

<div class="relative">
<img id="profile-photo"
src="https://placehold.co/150x150"
class="w-28 h-28 rounded-xl object-cover shadow border">

<button onclick="openPhotoModal()"
class="absolute -bottom-2 -right-2 bg-indigo-600 text-white p-2 rounded-full shadow hover:bg-indigo-700">
<i class="fas fa-camera text-xs"></i>
</button>
</div>

<div>
<h2 class="text-2xl font-bold">
Assalamu Alaikum,
</h2>

<div id="inspector-display-name"
class="text-xl font-semibold text-indigo-600">
Inspector Name
</div>

<div class="text-gray-500 text-sm">
Academic Inspector
</div>

<div class="flex gap-3 mt-3">

<div class="bg-indigo-50 border border-indigo-200 px-3 py-1 rounded-full text-sm">
üè´ Institutes: <span id="total-institutes" class="font-bold">0</span>
</div>

<div class="bg-green-50 border border-green-200 px-3 py-1 rounded-full text-sm">
üë®‚Äçüè´ Teachers: <span id="total-teachers" class="font-bold">0</span>
</div>

</div>

</div>

</div>

<!-- RIGHT MONTH -->
<div class="bg-indigo-50 p-4 rounded-xl border text-center md:text-right">

<label class="text-xs font-bold text-indigo-700 block mb-1">
Reporting Month
</label>

<input type="month"
id="report-month"
class="bg-white border rounded px-3 py-1 font-bold text-indigo-800 outline-none">

<button onclick="openReports()"
class="mt-3 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-bold shadow">
Fill Reports ‚Üí
</button>

</div>

</div>

<!-- STATUS CARDS -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">

<div class="card p-5">
<p class="text-xs text-gray-400 uppercase">Jaiza</p>
<p id="jaiza-percent" class="text-2xl font-bold text-teal-600">0%</p>
</div>

<div class="card p-5">
<p class="text-xs text-gray-400 uppercase">Tadris</p>
<p id="tadris-percent" class="text-2xl font-bold text-blue-600">0%</p>
</div>

<div class="card p-5">
<p class="text-xs text-gray-400 uppercase">Test</p>
<p id="test-percent" class="text-2xl font-bold text-indigo-600">0%</p>
</div>

<div class="card p-5">
<p class="text-xs text-gray-400 uppercase">Karkardagi</p>
<p id="kkd-percent" class="text-2xl font-bold text-purple-600">0%</p>
</div>

</div>

<!-- PERFORMANCE -->
<div class="grid md:grid-cols-2 gap-6 mb-10">

<div class="card p-6">
<h3 class="font-bold mb-3">Jaiza Performance</h3>
<div class="h-40 bg-gray-100 rounded"></div>
</div>

<div class="card p-6">
<h3 class="font-bold mb-3">Test Performance</h3>
<div class="h-40 bg-gray-100 rounded"></div>
</div>

</div>
</div>

<!-- REPORTS SECTION -->
<div id="reports-section" class="hidden">

<button onclick="backToSummary()" class="mb-6 text-indigo-600 font-semibold">
‚Üê Back to Dashboard
</button>

<!-- TABS -->
<div class="flex gap-3 mb-6">
<button class="tab-btn tab-active" onclick="switchTab('jaiza')">Jaiza</button>
<button class="tab-btn" onclick="switchTab('test')">Test</button>
<button class="tab-btn" onclick="switchTab('tadris')">Tadris</button>
<button class="tab-btn" onclick="switchTab('kkd')">Karkardagi</button>
</div>

<!-- JAIZA TAB -->
<div id="tab-jaiza"></div>

<!-- TEST TAB -->
<div id="tab-test" class="hidden">Test Reports Module</div>

<!-- TADRIS TAB -->
<div id="tab-tadris" class="hidden">Tadris Reports Module</div>

<!-- KKD TAB -->
<div id="tab-kkd" class="hidden">Karkardagi Module</div>

</div>

</main>
  
  <!-- PHOTO MODAL -->
<div id="photo-modal"
class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">

<div class="bg-white p-6 rounded-xl w-80 shadow-lg">
<h3 class="font-bold mb-3">Update Profile Photo</h3>

<input type="url"
id="photo-url-input"
placeholder="Paste image URL"
class="w-full border rounded p-2 mb-4">

<div class="flex justify-end gap-2">
<button onclick="closePhotoModal()"
class="px-4 py-2 bg-gray-200 rounded">
Cancel
</button>

<button onclick="savePhoto()"
class="px-4 py-2 bg-indigo-600 text-white rounded">
Save
</button>
</div>
</div>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import {getAuth,onAuthStateChanged,signOut} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import {getFirestore,doc,getDoc,collection,query,where,getDocs} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyDhPuyX0y1gb3uXoIRcdcQPkd5Q4KJFgl0",
authDomain:"data-f15ab.firebaseapp.com",
projectId:"data-f15ab",
storageBucket:"data-f15ab.appspot.com",
messagingSenderId:"449137002393",
appId:"1:449137002393:web:6a23721d00b1b0daeb3508"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let profilePhotoUrl = "";

async function loadProfilePhoto(){

const userDoc = await getDoc(doc(db,"users",currentUser.uid));

if(!userDoc.exists()) return;

const data = userDoc.data();

// profile photo
profilePhotoUrl = data.photo || "";
if(profilePhotoUrl){
document.getElementById("profile-photo").src = profilePhotoUrl;
}

// teachers total
document.getElementById("total-teachers").textContent =
data.teachersCount || 0;

}

function openPhotoModal(){
document.getElementById("photo-modal").classList.remove("hidden");
document.getElementById("photo-modal").classList.add("flex");
}

function closePhotoModal(){
document.getElementById("photo-modal").classList.add("hidden");
}

window.savePhoto = async function(){
const url = document.getElementById("photo-url-input").value;
if(!url) return;

await updateDoc(doc(db,"users",currentUser.uid),{
photo:url
});

document.getElementById("profile-photo").src = url;
closePhotoModal();
}
  
let currentUser=null;
let assignedJamiaat=[];
let completedReports=[];

onAuthStateChanged(auth,async user=>{
if(!user){location.href="index.html";return;}
currentUser=user;
await loadData();
});

async function loadData(){

const userDoc=await getDoc(doc(db,"users",currentUser.uid));
if(userDoc.exists()){
assignedJamiaat=userDoc.data().assignedJamiaat||[];
document.getElementById("inspector-display-name").textContent=userDoc.data().name||"Inspector";
}

const month=document.getElementById("report-month").value;
const q=query(collection(db,"jaiza_forms"),
where("month","==",month),
where("createdBy","==",currentUser.uid));

const snap=await getDocs(q);
completedReports=snap.docs.map(d=>d.data().jamiaName);

renderJamiaList();
renderSummary();
await loadProfilePhoto();
  // totals
document.getElementById("total-institutes").textContent =
assignedJamiaat.length;

function renderSummary(){
const total=assignedJamiaat.length;
const done=completedReports.length;
const percent=total?Math.round(done/total*100):0;

document.getElementById("jaiza-percent").textContent=percent+"%";
document.getElementById("test-percent").textContent=percent+"%";
document.getElementById("tadris-percent").textContent=percent+"%";
document.getElementById("kkd-percent").textContent=percent+"%";
}

function renderJamiaList(){

let html="";
assignedJamiaat.forEach(j=>{
const done=completedReports.includes(j);

html+=`
<div class="card p-4 mb-3 flex justify-between items-center">
<div>
<div class="font-bold text-lg">${j}</div>
<div class="text-sm ${done?'text-green-600':'text-orange-500'}">
${done?'Completed':'Pending'}
</div>
</div>

<button class="px-4 py-2 rounded-lg ${
done?'bg-gray-200 text-gray-400':'bg-indigo-600 text-white'
}">
${done?'Done':'Start'}
</button>
</div>
`;
});

document.getElementById("tab-jaiza").innerHTML=html;
}

window.openReports=()=>{
document.getElementById("summary-section").classList.add("hidden");
document.getElementById("reports-section").classList.remove("hidden");
}

window.backToSummary=()=>{
document.getElementById("reports-section").classList.add("hidden");
document.getElementById("summary-section").classList.remove("hidden");
}

window.openPhotoModal = function(){
document.getElementById("photo-modal").classList.remove("hidden");
document.getElementById("photo-modal").classList.add("flex");
}

window.closePhotoModal = function(){
document.getElementById("photo-modal").classList.add("hidden");
}

window.switchTab=(name)=>{
["jaiza","test","tadris","kkd"].forEach(t=>{
document.getElementById("tab-"+t).classList.add("hidden");
});
document.getElementById("tab-"+name).classList.remove("hidden");

document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("tab-active"));
event.target.classList.add("tab-active");
}

window.handleLogout=()=>signOut(auth);

const now=new Date();
document.getElementById("report-month").value=
now.getFullYear()+"-"+String(now.getMonth()+1).padStart(2,"0");

document.getElementById("report-month").onchange=loadData;

</script>
</body>
</html>




