<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Academic Inspector</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
body{font-family:Poppins;background:#f1f5f9}
.card{background:white;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.tab-btn{padding:8px 16px;border-radius:8px;font-weight:600}
.tab-active{background:#4f46e5;color:white}
</style>
</head>
<body>

<!-- NAV -->
<div class="bg-white shadow p-4 flex justify-between">
<div class="font-bold text-xl text-gray-800">Academic Inspector</div>
<button onclick="handleLogout()" class="bg-red-500 text-white px-4 py-2 rounded">Logout</button>
</div>

<main class="max-w-7xl mx-auto p-6">

<!-- SUMMARY SECTION -->
<div id="summary-section">

<!-- HEADER -->
<div class="card p-6 flex justify-between items-center mb-6">
<div>
<h2 class="text-2xl font-bold">
Assalamu Alaikum, 
<span id="inspector-display-name" class="text-indigo-600">Inspector</span>
</h2>
<p class="text-gray-500 text-sm">Academic performance overview</p>
</div>

<div class="bg-indigo-50 p-3 rounded-lg">
<label class="text-xs font-bold text-indigo-700">Reporting Month</label>
<input type="month" id="report-month" class="bg-transparent font-bold text-indigo-800 outline-none">
</div>
</div>

<!-- STATUS CARDS -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">

<div class="card p-5">
<p class="text-xs text-gray-400 uppercase">Jaiza</p>
<p id="jaiza-percent" class="text-2xl font-bold text-teal-600">0%</p>
</div>

<div class="card p-5">
<p class="text-xs text-gray-400 uppercase">Tadris</p>
<p id="tadris-percent" class="text-2xl font-bold text-blue-600">0%</p>
</div>

<div class="card p-5">
<p class="text-xs text-gray-400 uppercase">Test</p>
<p id="test-percent" class="text-2xl font-bold text-indigo-600">0%</p>
</div>

<div class="card p-5">
<p class="text-xs text-gray-400 uppercase">Karkardagi</p>
<p id="kkd-percent" class="text-2xl font-bold text-purple-600">0%</p>
</div>

</div>

<!-- PERFORMANCE -->
<div class="grid md:grid-cols-2 gap-6 mb-10">

<div class="card p-6">
<h3 class="font-bold mb-3">Jaiza Performance</h3>
<div class="h-40 bg-gray-100 rounded"></div>
</div>

<div class="card p-6">
<h3 class="font-bold mb-3">Test Performance</h3>
<div class="h-40 bg-gray-100 rounded"></div>
</div>

</div>

<!-- FILL REPORTS BUTTON -->
<div class="text-center">
<button onclick="openReports()"
class="bg-indigo-600 hover:bg-indigo-700 text-white px-10 py-4 rounded-xl text-lg font-bold shadow-lg transition">
Fill Reports →
</button>
</div>

</div>

<!-- REPORTS SECTION -->
<div id="reports-section" class="hidden">

<button onclick="backToSummary()" class="mb-6 text-indigo-600 font-semibold">
← Back to Dashboard
</button>

<!-- TABS -->
<div class="flex gap-3 mb-6">
<button class="tab-btn tab-active" onclick="switchTab('jaiza')">Jaiza</button>
<button class="tab-btn" onclick="switchTab('test')">Test</button>
<button class="tab-btn" onclick="switchTab('tadris')">Tadris</button>
<button class="tab-btn" onclick="switchTab('kkd')">Karkardagi</button>
</div>

<!-- JAIZA TAB -->
<div id="tab-jaiza"></div>

<!-- TEST TAB -->
<div id="tab-test" class="hidden">Test Reports Module</div>

<!-- TADRIS TAB -->
<div id="tab-tadris" class="hidden">Tadris Reports Module</div>

<!-- KKD TAB -->
<div id="tab-kkd" class="hidden">Karkardagi Module</div>

</div>

</main>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import {getAuth,onAuthStateChanged,signOut} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import {getFirestore,doc,getDoc,collection,query,where,getDocs} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyDhPuyX0y1gb3uXoIRcdcQPkd5Q4KJFgl0",
authDomain:"data-f15ab.firebaseapp.com",
projectId:"data-f15ab",
storageBucket:"data-f15ab.appspot.com",
messagingSenderId:"449137002393",
appId:"1:449137002393:web:6a23721d00b1b0daeb3508"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let currentUser=null;
let assignedJamiaat=[];
let completedReports=[];

onAuthStateChanged(auth,async user=>{
if(!user){location.href="index.html";return;}
currentUser=user;
await loadData();
});

async function loadData(){

const userDoc=await getDoc(doc(db,"users",currentUser.uid));
if(userDoc.exists()){
assignedJamiaat=userDoc.data().assignedJamiaat||[];
document.getElementById("inspector-display-name").textContent=userDoc.data().name||"Inspector";
}

const month=document.getElementById("report-month").value;
const q=query(collection(db,"jaiza_forms"),
where("month","==",month),
where("createdBy","==",currentUser.uid));

const snap=await getDocs(q);
completedReports=snap.docs.map(d=>d.data().jamiaName);

renderJamiaList();
renderSummary();
}

function renderSummary(){
const total=assignedJamiaat.length;
const done=completedReports.length;
const percent=total?Math.round(done/total*100):0;

document.getElementById("jaiza-percent").textContent=percent+"%";
document.getElementById("test-percent").textContent=percent+"%";
document.getElementById("tadris-percent").textContent=percent+"%";
document.getElementById("kkd-percent").textContent=percent+"%";
}

function renderJamiaList(){

let html="";
assignedJamiaat.forEach(j=>{
const done=completedReports.includes(j);

html+=`
<div class="card p-4 mb-3 flex justify-between items-center">
<div>
<div class="font-bold text-lg">${j}</div>
<div class="text-sm ${done?'text-green-600':'text-orange-500'}">
${done?'Completed':'Pending'}
</div>
</div>

<button class="px-4 py-2 rounded-lg ${
done?'bg-gray-200 text-gray-400':'bg-indigo-600 text-white'
}">
${done?'Done':'Start'}
</button>
</div>
`;
});

document.getElementById("tab-jaiza").innerHTML=html;
}

window.openReports=()=>{
document.getElementById("summary-section").classList.add("hidden");
document.getElementById("reports-section").classList.remove("hidden");
}

window.backToSummary=()=>{
document.getElementById("reports-section").classList.add("hidden");
document.getElementById("summary-section").classList.remove("hidden");
}

window.switchTab=(name)=>{
["jaiza","test","tadris","kkd"].forEach(t=>{
document.getElementById("tab-"+t).classList.add("hidden");
});
document.getElementById("tab-"+name).classList.remove("hidden");

document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("tab-active"));
event.target.classList.add("tab-active");
}

window.handleLogout=()=>signOut(auth);

const now=new Date();
document.getElementById("report-month").value=
now.getFullYear()+"-"+String(now.getMonth()+1).padStart(2,"0");

document.getElementById("report-month").onchange=loadData;

</script>
</body>
</html>
