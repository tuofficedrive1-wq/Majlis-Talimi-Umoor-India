<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Academic Inspector Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
body{font-family:'Poppins',sans-serif;background:#f0f2f5}
.card{background:white;border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.dash-tab-btn{padding:8px 16px;border-radius:8px;font-weight:600;transition:all 0.2s}
.dash-tab-btn.active{color:#14b8a6;border-bottom:2px solid #14b8a6}
.dash-tab-btn:not(.active){color:#6b7280;border-bottom:2px solid transparent}
.tab-content-panel{display:none}
.tab-content-panel.active{display:block}
</style>
</head>
<body class="antialiased text-gray-800">

<div class="bg-white shadow p-4 flex justify-between items-center">
<div class="font-bold text-xl text-gray-800">Academic Inspector Dashboard</div>
<button onclick="window.handleLogout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition">Logout</button>
</div>

<main class="max-w-7xl mx-auto p-6">

<!-- DASHBOARD VIEW (like index.html) -->
<div id="summary-section">

<!-- Profile + Reporting Month -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">

<div class="flex flex-col md:flex-row items-center gap-6">
<div class="relative shrink-0">
<img id="profile-photo" src="https://placehold.co/150x150" class="w-24 h-24 md:w-28 md:h-28 rounded-full object-cover border-4 border-white shadow-md">
<button onclick="window.openPhotoModal()" class="absolute bottom-0 right-0 bg-teal-600 text-white p-2 rounded-full hover:bg-teal-700 shadow-lg">
<i class="fas fa-camera text-xs"></i>
</button>
</div>
<div class="text-center md:text-left">
<h2 class="text-xl font-bold text-gray-800 mb-1">Assalamu Alaikum,</h2>
<h3 id="inspector-display-name" class="text-xl text-teal-700 font-semibold">Inspector</h3>
<p class="text-gray-500 text-sm mb-3">Academic Inspector</p>
<div class="flex flex-wrap justify-center md:justify-start gap-3">
<div class="text-xs bg-blue-50 text-blue-700 px-3 py-1.5 rounded-full border border-blue-200">
<i class="fas fa-mosque mr-1"></i> Jamiaat: <span id="total-institutes" class="font-bold">0</span>
</div>
<div class="text-xs bg-emerald-50 text-emerald-700 px-3 py-1.5 rounded-full border border-emerald-200">
<i class="fas fa-chalkboard-teacher mr-1"></i> Teachers: <span id="total-teachers" class="font-bold">0</span>
</div>
</div>
</div>
</div>

<div class="bg-gray-50 p-4 rounded-xl border border-gray-200 flex flex-col sm:flex-row items-end gap-3 w-full sm:w-auto">
<div>
<label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Reporting Month</label>
<input type="month" id="report-month" class="w-full sm:w-48 p-2 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-teal-500 outline-none">
</div>
<button onclick="window.openReports()" class="w-full sm:w-auto bg-teal-600 hover:bg-teal-700 text-white text-sm font-bold py-2 px-4 rounded-lg shadow-sm transition flex items-center justify-center gap-2">
<span>Fill Reports</span> <i class="fas fa-arrow-right"></i>
</button>
</div>
</div>

<!-- Tabs: Overview & Status -->
<div class="flex overflow-x-auto gap-4 mb-6 border-b border-gray-200 pb-1">
<button onclick="window.switchDashTab('overview')" id="tab-btn-overview" class="dash-tab-btn active px-4 py-2 text-sm font-semibold whitespace-nowrap">
<i class="fas fa-home mr-2"></i> Overview & Status
</button>
<button onclick="window.switchDashTab('details')" id="tab-btn-details" class="dash-tab-btn px-4 py-2 text-sm font-semibold text-gray-500 hover:text-teal-600 whitespace-nowrap">
<i class="fas fa-list mr-2"></i> Jamia Details
</button>
</div>

<!-- Overview Tab Content -->
<div id="dash-view-overview" class="tab-content-panel active space-y-6">

<!-- Summary Cards (5 cards) -->
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">

<div class="relative p-5 rounded-xl bg-teal-50 border border-teal-100 shadow-sm">
<div class="flex justify-between items-start">
<div>
<p class="text-xs font-bold text-teal-700 uppercase tracking-wider">Inspection</p>
<p id="inspection-percent" class="text-2xl font-bold text-teal-800 mt-1">0%</p>
<p id="inspection-count" class="text-xs text-teal-600 mt-0.5">0/0 Jamiaat</p>
</div>
<div class="p-2 bg-white/70 rounded-lg"><i class="fas fa-clipboard-check text-teal-600"></i></div>
</div>
<div class="mt-3 h-2 bg-teal-100 rounded-full overflow-hidden">
<div id="inspection-bar" class="h-2 bg-teal-500 rounded-full transition-all duration-500" style="width:0%"></div>
</div>
</div>

<div class="relative p-5 rounded-xl bg-blue-50 border border-blue-100 shadow-sm">
<div class="flex justify-between items-start">
<div>
<p class="text-xs font-bold text-blue-700 uppercase tracking-wider">Recording</p>
<p id="recording-percent" class="text-2xl font-bold text-blue-800 mt-1">0%</p>
<p id="recording-count" class="text-xs text-blue-600 mt-0.5">0/0 Jamiaat</p>
</div>
<div class="p-2 bg-white/70 rounded-lg"><i class="fas fa-microphone text-blue-600"></i></div>
</div>
<div class="mt-3 h-2 bg-blue-100 rounded-full overflow-hidden">
<div id="recording-bar" class="h-2 bg-blue-500 rounded-full transition-all duration-500" style="width:0%"></div>
</div>
</div>

<div class="relative p-5 rounded-xl bg-indigo-50 border border-indigo-100 shadow-sm">
<div class="flex justify-between items-start">
<div>
<p class="text-xs font-bold text-indigo-700 uppercase tracking-wider">Monthly Test</p>
<p id="test-percent" class="text-2xl font-bold text-indigo-800 mt-1">0%</p>
<p id="test-count" class="text-xs text-indigo-600 mt-0.5">0/0 Jamiaat</p>
</div>
<div class="p-2 bg-white/70 rounded-lg"><i class="fas fa-file-alt text-indigo-600"></i></div>
</div>
<div class="mt-3 h-2 bg-indigo-100 rounded-full overflow-hidden">
<div id="test-bar" class="h-2 bg-indigo-500 rounded-full transition-all duration-500" style="width:0%"></div>
</div>
</div>

<div class="relative p-5 rounded-xl bg-purple-50 border border-purple-100 shadow-sm">
<div class="flex justify-between items-start">
<div>
<p class="text-xs font-bold text-purple-700 uppercase tracking-wider">Takmeele Nisab</p>
<p id="takmeel-percent" class="text-2xl font-bold text-purple-800 mt-1">0%</p>
<p id="takmeel-count" class="text-xs text-purple-600 mt-0.5">0/0 Jamiaat</p>
</div>
<div class="p-2 bg-white/70 rounded-lg"><i class="fas fa-graduation-cap text-purple-600"></i></div>
</div>
<div class="mt-3 h-2 bg-purple-100 rounded-full overflow-hidden">
<div id="takmeel-bar" class="h-2 bg-purple-500 rounded-full transition-all duration-500" style="width:0%"></div>
</div>
</div>

<div class="relative p-5 rounded-xl bg-amber-50 border border-amber-100 shadow-sm">
<div class="flex justify-between items-start">
<div>
<p class="text-xs font-bold text-amber-700 uppercase tracking-wider">Students Enrollment</p>
<p id="enrollment-percent" class="text-2xl font-bold text-amber-800 mt-1">0%</p>
<p id="enrollment-count" class="text-xs text-amber-600 mt-0.5">0/0 Jamiaat</p>
</div>
<div class="p-2 bg-white/70 rounded-lg"><i class="fas fa-user-graduate text-amber-600"></i></div>
</div>
<div class="mt-3 h-2 bg-amber-100 rounded-full overflow-hidden">
<div id="enrollment-bar" class="h-2 bg-amber-500 rounded-full transition-all duration-500" style="width:0%"></div>
</div>
</div>

</div>

<!-- Charts -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
<div class="flex justify-between items-center mb-4">
<h4 id="inspection-chart-title" class="font-bold text-gray-700">Inspection Performance</h4>
<button id="download-inspection-chart" class="text-gray-400 hover:text-teal-600"><i class="fas fa-download"></i></button>
</div>
<div style="height:350px;"><canvas id="inspectionChart"></canvas></div>
</div>
<div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
<div class="flex justify-between items-center mb-4">
<h4 id="test-chart-title" class="font-bold text-gray-700">Monthly Test Performance</h4>
<button id="download-test-chart" class="text-gray-400 hover:text-indigo-600"><i class="fas fa-download"></i></button>
</div>
<div style="height:350px;"><canvas id="testChart"></canvas></div>
</div>
</div>

</div>

<!-- Jamia Details Tab (5 sub-tabs with Jamia list) -->
<div id="dash-view-details" class="tab-content-panel hidden">
<div class="flex flex-wrap gap-2 mb-6">
<button class="sub-tab-btn active px-4 py-2 rounded-lg font-semibold text-sm bg-teal-600 text-white" data-subtab="inspection">Inspection</button>
<button class="sub-tab-btn px-4 py-2 rounded-lg font-semibold text-sm bg-gray-200 text-gray-700 hover:bg-gray-300" data-subtab="recording">Recording</button>
<button class="sub-tab-btn px-4 py-2 rounded-lg font-semibold text-sm bg-gray-200 text-gray-700 hover:bg-gray-300" data-subtab="monthly-test">Monthly Test</button>
<button class="sub-tab-btn px-4 py-2 rounded-lg font-semibold text-sm bg-gray-200 text-gray-700 hover:bg-gray-300" data-subtab="takmeele-nisab">Takmeele Nisab</button>
<button class="sub-tab-btn px-4 py-2 rounded-lg font-semibold text-sm bg-gray-200 text-gray-700 hover:bg-gray-300" data-subtab="students-enrollment">Students Enrollment Data</button>
</div>

<div id="tab-inspection" class="sub-tab-content space-y-3"></div>
<div id="tab-recording" class="sub-tab-content hidden space-y-3"></div>
<div id="tab-monthly-test" class="sub-tab-content hidden space-y-3"></div>
<div id="tab-takmeele-nisab" class="sub-tab-content hidden space-y-3"></div>
<div id="tab-students-enrollment" class="sub-tab-content hidden space-y-3"></div>
</div>

</div>

<!-- REPORTS (Fill Reports) -->
<div id="reports-section" class="hidden">
<button onclick="window.backToSummary()" class="mb-6 text-teal-600 hover:text-teal-800 font-medium">
<i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
</button>

<div class="flex flex-wrap gap-2 mb-6">
<button class="sub-tab-btn active px-4 py-2 rounded-lg font-semibold text-sm bg-teal-600 text-white" data-subtab="inspection">Inspection</button>
<button class="sub-tab-btn px-4 py-2 rounded-lg font-semibold text-sm bg-gray-200 text-gray-700" data-subtab="recording">Recording</button>
<button class="sub-tab-btn px-4 py-2 rounded-lg font-semibold text-sm bg-gray-200 text-gray-700" data-subtab="monthly-test">Monthly Test</button>
<button class="sub-tab-btn px-4 py-2 rounded-lg font-semibold text-sm bg-gray-200 text-gray-700" data-subtab="takmeele-nisab">Takmeele Nisab</button>
<button class="sub-tab-btn px-4 py-2 rounded-lg font-semibold text-sm bg-gray-200 text-gray-700" data-subtab="students-enrollment">Students Enrollment Data</button>
</div>

<div id="report-tab-inspection" class="sub-tab-content space-y-3"></div>
<div id="report-tab-recording" class="sub-tab-content hidden space-y-3"></div>
<div id="report-tab-monthly-test" class="sub-tab-content hidden space-y-3"></div>
<div id="report-tab-takmeele-nisab" class="sub-tab-content hidden space-y-3"></div>
<div id="report-tab-students-enrollment" class="sub-tab-content hidden space-y-3"></div>
</div>

</main>

<!-- PHOTO MODAL -->
<div id="photo-modal"
class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
<div class="bg-white p-6 rounded-xl w-80">
<h3 class="font-bold mb-3">Update Profile Photo</h3>

<input type="file"
id="photo-file-input"
accept="image/*"
class="w-full border rounded p-2 mb-4">

<div class="flex justify-end gap-2">
<button onclick="window.closePhotoModal()" class="px-4 py-2 bg-gray-200 rounded">
Cancel
</button>
<button onclick="window.savePhoto()" class="px-4 py-2 bg-indigo-600 text-white rounded">
Save
</button>
</div>
</div>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import {getAuth,onAuthStateChanged,signOut} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import {getFirestore,doc,getDoc,collection,query,where,getDocs,updateDoc} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
import {getStorage,ref,uploadBytes,getDownloadURL} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-storage.js";

const firebaseConfig={
apiKey:"AIzaSyDhPuyX0y1gb3uXoIRcdcQPkd5Q4KJFgl0",
authDomain:"data-f15ab.firebaseapp.com",
projectId:"data-f15ab"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const storage = getStorage(app);

let currentUser=null;
let assignedJamiaat=[];
let completedInspection=[];
let completedRecording=[];
let completedTest=[];
let completedTakmeel=[];
let completedEnrollment=[];

// ===== AUTH =====
onAuthStateChanged(auth,async user=>{
if(!user){location.href="index.html";return;}
currentUser=user;
await loadData();
});

// ===== LOAD DATA =====
async function loadData(){
const userDoc=await getDoc(doc(db,"users",currentUser.uid));
if(userDoc.exists()){
const data=userDoc.data();
assignedJamiaat=data.assignedJamiaat||[];
document.getElementById("inspector-display-name").textContent=data.name||"Inspector";
document.getElementById("total-teachers").textContent=data.teachersCount||0;
if(data.photo) document.getElementById("profile-photo").src=data.photo;
}

document.getElementById("total-institutes").textContent=assignedJamiaat.length;

const month=document.getElementById("report-month").value;

// Inspection (jaiza_forms)
const qJaiza=query(collection(db,"jaiza_forms"),where("month","==",month),where("createdBy","==",currentUser.uid));
const snapJaiza=await getDocs(qJaiza);
completedInspection=snapJaiza.docs.map(d=>d.data().jamiaName);

// Recording (tadris - similar collection if exists)
try{
const qTadris=query(collection(db,"tadris_recordings"),where("month","==",month),where("createdBy","==",currentUser.uid));
const snapTadris=await getDocs(qTadris);
completedRecording=snapTadris.docs.map(d=>d.data().jamiaName||d.data().jamia);
}catch(e){completedRecording=[];}

// Monthly Test
try{
const qTest=query(collection(db,"monthly_test_sheets"),where("month","==",month),where("adminUid","==",currentUser.uid));
const snapTest=await getDocs(qTest);
completedTest=[...new Set(snapTest.docs.map(d=>d.data().jamiaName))];
}catch(e){completedTest=[];}

// Takmeele Nisab & Enrollment - use inspection as placeholder until collections exist
completedTakmeel=completedInspection;
completedEnrollment=completedInspection;

renderSummary();
renderAllJamiaLists();
renderCharts();
setupSubTabs();
}

// ===== RENDER SUMMARY (5 cards) =====
function renderSummary(){
const total=assignedJamiaat.length;
const setCard=(idPrefix,doneList)=>{
const done=doneList.filter(j=>assignedJamiaat.includes(j)).length;
const percent=total?Math.round(done/total*100):0;
const pctEl=document.getElementById(idPrefix+'-percent');
const cntEl=document.getElementById(idPrefix+'-count');
const barEl=document.getElementById(idPrefix+'-bar');
if(pctEl)pctEl.textContent=percent+'%';
if(cntEl)cntEl.textContent=`${done}/${total} Jamiaat`;
if(barEl)barEl.style.width=percent+'%';
};

setCard('inspection',completedInspection);
setCard('recording',completedRecording);
setCard('test',completedTest);
setCard('takmeel',completedTakmeel);
setCard('enrollment',completedEnrollment);
}

function renderJamiaListForTab(containerId,doneList,label){
const container=document.getElementById(containerId);
if(!container)return;
let html='';
assignedJamiaat.forEach(j=>{
const done=doneList.includes(j);
html+=`<div class="card p-4 flex justify-between items-center">
<div>
<div class="font-bold text-gray-800">${j}</div>
<div class="text-sm ${done?'text-green-600':'text-orange-500'} font-medium">${done?'Completed':'Pending'}</div>
</div>
<button class="px-4 py-2 rounded-lg text-sm font-semibold ${done?'bg-gray-200 text-gray-600':'bg-teal-600 text-white hover:bg-teal-700'}">${done?'Done':'Start'}</button>
</div>`;
});
container.innerHTML=html||'<p class="text-gray-500 text-center py-4">No Jamiaat assigned.</p>';
}

function renderAllJamiaLists(){
renderJamiaListForTab('tab-inspection',completedInspection,'Inspection');
renderJamiaListForTab('tab-recording',completedRecording,'Recording');
renderJamiaListForTab('tab-monthly-test',completedTest,'Monthly Test');
renderJamiaListForTab('tab-takmeele-nisab',completedTakmeel,'Takmeele Nisab');
renderJamiaListForTab('tab-students-enrollment',completedEnrollment,'Students Enrollment');
renderJamiaListForTab('report-tab-inspection',completedInspection,'Inspection');
renderJamiaListForTab('report-tab-recording',completedRecording,'Recording');
renderJamiaListForTab('report-tab-monthly-test',completedTest,'Monthly Test');
renderJamiaListForTab('report-tab-takmeele-nisab',completedTakmeel,'Takmeele Nisab');
renderJamiaListForTab('report-tab-students-enrollment',completedEnrollment,'Students Enrollment');
}

var subtabsSetup=false;
function setupSubTabs(){
if(subtabsSetup)return;
subtabsSetup=true;
document.querySelectorAll('.sub-tab-btn').forEach(btn=>{
btn.addEventListener('click',()=>{
const subtab=btn.dataset.subtab;
const parent=btn.closest('#dash-view-details')||btn.closest('#reports-section');
if(!parent)return;
parent.querySelectorAll('.sub-tab-btn').forEach(b=>{
b.classList.remove('bg-teal-600','text-white');
b.classList.add('bg-gray-200','text-gray-700');
});
btn.classList.remove('bg-gray-200','text-gray-700');
btn.classList.add('bg-teal-600','text-white');

const prefix=parent.id==='reports-section'?'report-tab-':'tab-';
const map={inspection:'inspection',recording:'recording','monthly-test':'monthly-test','takmeele-nisab':'takmeele-nisab','students-enrollment':'students-enrollment'};
parent.querySelectorAll('.sub-tab-content').forEach(c=>c.classList.add('hidden'));
const target=document.getElementById(prefix+map[subtab]);
if(target){target.classList.remove('hidden');}
});
});
}

// ===== GLOBAL UI =====
window.openReports=()=>{
document.getElementById("summary-section").classList.add("hidden");
document.getElementById("reports-section").classList.remove("hidden");
};

window.backToSummary=()=>{
document.getElementById("reports-section").classList.add("hidden");
document.getElementById("summary-section").classList.remove("hidden");
};

window.openPhotoModal=()=>{
document.getElementById("photo-modal").classList.remove("hidden");
document.getElementById("photo-modal").classList.add("flex");
};

window.closePhotoModal=()=>{
document.getElementById("photo-modal").classList.add("hidden");
};

window.savePhoto = async function(){

const fileInput = document.getElementById("photo-file-input");
if(!fileInput.files.length) return;

const file = fileInput.files[0];

// path: users/{uid}/profile.jpg
const storageRef = ref(storage, `users/${currentUser.uid}/profile.jpg`);

await uploadBytes(storageRef, file);

const downloadURL = await getDownloadURL(storageRef);

// save in firestore
await updateDoc(doc(db,"users",currentUser.uid),{
photo:downloadURL
});

// update UI
document.getElementById("profile-photo").src = downloadURL;

window.closePhotoModal();
}

window.switchDashTab=(tabName)=>{
document.querySelectorAll('.tab-content-panel').forEach(el=>{el.classList.remove('active');el.classList.add('hidden');});
document.querySelectorAll('.dash-tab-btn').forEach(btn=>{
btn.classList.remove('active','text-teal-600','border-teal-600');
btn.classList.add('text-gray-500');
});
var targetView=document.getElementById('dash-view-'+tabName);
if(targetView){targetView.classList.add('active');targetView.classList.remove('hidden');}
var otherId=tabName==='overview'?'details':'overview';
var otherView=document.getElementById('dash-view-'+otherId);
if(otherView){otherView.classList.add('hidden');otherView.classList.remove('active');}
var btn=document.getElementById('tab-btn-'+tabName);
if(btn){btn.classList.add('active','text-teal-600');btn.classList.remove('text-gray-500');}
var otherBtn=document.getElementById('tab-btn-'+otherId);
if(otherBtn){otherBtn.classList.remove('active','text-teal-600');otherBtn.classList.add('text-gray-500');}
};

window.handleLogout=()=>signOut(auth);

// ===== CURRENT MONTH =====
const now=new Date();
document.getElementById("report-month").value=
now.getFullYear()+"-"+String(now.getMonth()+1).padStart(2,"0");

document.getElementById("report-month").onchange=loadData;

  function renderCharts(){

var labels=assignedJamiaat;
var inspectionValues=assignedJamiaat.map(function(j){return completedInspection.includes(j)?100:0;});
var testValues=assignedJamiaat.map(function(j){return completedTest.includes(j)?100:0;});

if(window.inspectionChartObj){window.inspectionChartObj.destroy();window.inspectionChartObj=null;}
if(window.testChartObj){window.testChartObj.destroy();window.testChartObj=null;}

window.inspectionChartObj = new Chart(
document.getElementById("inspectionChart"),
{
type:"bar",
data:{
labels:labels,
datasets:[{
data:inspectionValues,
backgroundColor:(function(){var c=document.getElementById("inspectionChart");if(!c)return'#14b8a6';var g=c.getContext("2d").createLinearGradient(0,0,0,400);g.addColorStop(0,'#2dd4bf');g.addColorStop(1,'#0f766e');return g;}()),
borderRadius:8,
barPercentage:0.6
}]
},
plugins:(typeof ChartDataLabels!=='undefined'?[ChartDataLabels]:[]),
options:{
responsive:true,
maintainAspectRatio:false,
layout:{padding:{top:20}},
plugins:{legend:{display:false},datalabels:{anchor:'end',align:'top',formatter:function(v){return v>0?v+'%':'';},color:'#0f766e',font:{weight:'bold',size:12},offset:-5}},
scales:{
y:{beginAtZero:true,max:100,grid:{color:'#f3f4f6'}},
x:{ticks:{autoSkip:false,maxRotation:45,font:{size:11}}}
}
}
});

var c2=document.getElementById("testChart");
if(c2){
var ctx2=c2.getContext("2d");
var g2=ctx2.createLinearGradient(0,0,0,400);
g2.addColorStop(0,'#818cf8');
g2.addColorStop(1,'#4338ca');
window.testChartObj = new Chart(ctx2,{
type:"bar",
data:{labels:labels,datasets:[{label:"Test",data:testValues,backgroundColor:g2,borderColor:"#3730a3",borderWidth:1,borderRadius:8,barPercentage:0.6}]},
plugins:(typeof ChartDataLabels!=='undefined'?[ChartDataLabels]:[]),
options:{responsive:true,maintainAspectRatio:false,layout:{padding:{top:20}},plugins:{legend:{display:false},datalabels:{anchor:'end',align:'top',formatter:function(v){return v>0?v+'%':'';},color:'#4338ca',font:{weight:'bold',size:12},offset:-5}},scales:{y:{beginAtZero:true,max:100,grid:{color:'#f3f4f6'}},x:{ticks:{autoSkip:false,maxRotation:45,font:{size:11}}}}}
});
}

var month=document.getElementById("report-month").value;
var parts=month?month.split('-'):['',''];
var monthNames=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
var ms=parts[1]?monthNames[parseInt(parts[1])-1]:'';
var ys=parts[0]||'';
var t1=document.getElementById('inspection-chart-title');
var t2=document.getElementById('test-chart-title');
if(t1)t1.textContent='Inspection Performance ('+ms+' '+ys+')';
if(t2)t2.textContent='Monthly Test Performance ('+ms+' '+ys+')';

var dl1=document.getElementById('download-inspection-chart');
if(dl1)dl1.onclick=function(){var c=document.getElementById("inspectionChart");if(c){var a=document.createElement('a');a.href=c.toDataURL('image/png');a.download='Inspection_Chart.png';document.body.appendChild(a);a.click();document.body.removeChild(a);}};
var dl2=document.getElementById('download-test-chart');
if(dl2)dl2.onclick=function(){var c=document.getElementById("testChart");if(c){var a=document.createElement('a');a.href=c.toDataURL('image/png');a.download='Test_Chart.png';document.body.appendChild(a);a.click();document.body.removeChild(a);}};

}

</script>
</body>
</html>













