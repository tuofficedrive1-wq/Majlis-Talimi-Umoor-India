<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Academic Inspector Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
body{font-family:Poppins;background:#f3f4f6}
.tab-btn{padding:8px 16px;border-radius:8px;font-weight:600}
.tab-active{background:#4338ca;color:white}
</style>
</head>
<body>

<!-- NAV -->
<nav class="bg-indigo-800 text-white px-6 py-3 flex justify-between">
<div class="font-bold text-lg flex gap-2 items-center">
<i class="fas fa-user-shield"></i> Academic Inspector
</div>
<button onclick="handleLogout()" class="bg-red-500 px-3 py-1 rounded">Logout</button>
</nav>

<main class="max-w-7xl mx-auto p-6">

<!-- HEADER -->
<div class="bg-white p-6 rounded-xl shadow flex justify-between items-center mb-6">
<div>
<h1 class="text-2xl font-bold">
Welcome, <span id="inspector-display-name" class="text-indigo-600">Inspector</span>
</h1>
<p class="text-gray-500 text-sm">Manage assigned Jamia academic reports</p>
</div>

<div class="bg-indigo-50 p-3 rounded-lg">
<label class="text-xs font-bold text-indigo-700 block">Reporting Month</label>
<input type="month" id="report-month" class="bg-transparent font-bold text-indigo-800 outline-none">
</div>
</div>

<!-- SUMMARY -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">

<div class="bg-white p-5 rounded-xl shadow border">
<p class="text-xs text-gray-400 uppercase">Total Assigned</p>
<p id="stat-total" class="text-2xl font-bold text-indigo-600">0</p>
</div>

<div class="bg-white p-5 rounded-xl shadow border">
<p class="text-xs text-gray-400 uppercase">Completed</p>
<p id="stat-done" class="text-2xl font-bold text-green-600">0</p>
</div>

<div class="bg-white p-5 rounded-xl shadow border">
<p class="text-xs text-gray-400 uppercase">Remaining</p>
<p id="stat-pending" class="text-2xl font-bold text-orange-500">0</p>
</div>

<div class="bg-white p-5 rounded-xl shadow border">
<p class="text-xs text-gray-400 uppercase">Completion %</p>
<p id="stat-percent" class="text-2xl font-bold text-purple-600">0%</p>
</div>

</div>

<!-- TABS -->
<div class="flex gap-3 mb-6">
<button class="tab-btn tab-active" onclick="switchTab('overview')">Overview</button>
<button class="tab-btn" onclick="switchTab('jaiza')">Jaiza Reports</button>
<button class="tab-btn" onclick="switchTab('test')">Test Reports</button>
<button class="tab-btn" onclick="switchTab('tadris')">Tadris Reports</button>
</div>

<!-- OVERVIEW TAB -->
<div id="tab-overview">

<div class="bg-white rounded-xl shadow border overflow-hidden">
<div class="p-4 bg-gray-50 border-b font-bold">Assigned Jamia List</div>
<div id="jamia-list"></div>
</div>

</div>

<!-- JAIZA TAB -->
<div id="tab-jaiza" class="hidden">
<div class="bg-white rounded-xl shadow border overflow-hidden">
<div class="p-4 bg-gray-50 border-b font-bold">Submitted Jaiza Reports</div>
<table class="w-full">
<thead class="bg-gray-50 border-b">
<tr>
<th class="p-3 text-left">Jamia</th>
<th class="p-3 text-left">Month</th>
<th class="p-3 text-left">Status</th>
</tr>
</thead>
<tbody id="jaiza-table"></tbody>
</table>
</div>
</div>

<!-- TEST TAB -->
<div id="tab-test" class="hidden">
<div class="bg-white p-6 rounded-xl shadow text-gray-500">
Test reports module coming here
</div>
</div>

<!-- TADRIS TAB -->
<div id="tab-tadris" class="hidden">
<div class="bg-white p-6 rounded-xl shadow text-gray-500">
Tadris reports module coming here
</div>
</div>

</main>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import {getAuth,onAuthStateChanged,signOut} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import {getFirestore,doc,getDoc,collection,query,where,getDocs} from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyDhPuyX0y1gb3uXoIRcdcQPkd5Q4KJFgl0",
authDomain:"data-f15ab.firebaseapp.com",
projectId:"data-f15ab",
storageBucket:"data-f15ab.appspot.com",
messagingSenderId:"449137002393",
appId:"1:449137002393:web:6a23721d00b1b0daeb3508"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let currentUser=null;
let assignedJamiaat=[];
let completedReports=[];

onAuthStateChanged(auth,async user=>{
if(!user){location.href="index.html";return;}
currentUser=user;
await loadInspectorData();
});

async function loadInspectorData(){

const userDoc=await getDoc(doc(db,"users",currentUser.uid));
if(userDoc.exists()){
assignedJamiaat=userDoc.data().assignedJamiaat||[];
document.getElementById("inspector-display-name").textContent=userDoc.data().name||"Inspector";
}

const month=document.getElementById("report-month").value;
const q=query(collection(db,"jaiza_forms"),
where("month","==",month),
where("createdBy","==",currentUser.uid));

const snap=await getDocs(q);
completedReports=snap.docs.map(d=>d.data().jamiaName);

renderDashboard();
renderJaizaTable(month);
}

function renderDashboard(){

let html="";
let done=0;

assignedJamiaat.forEach(j=>{
const isDone=completedReports.includes(j);
if(isDone)done++;

html+=`
<div class="p-4 flex justify-between border-b">
<div>
<div class="font-bold">${j}</div>
<div class="text-xs ${isDone?'text-green-600':'text-orange-500'}">
${isDone?'Completed':'Pending'}
</div>
</div>
<button class="px-3 py-1 rounded text-sm ${
isDone?'bg-gray-200 text-gray-400':'bg-indigo-600 text-white'
}">
${isDone?'Done':'Start'}
</button>
</div>`;
});

document.getElementById("jamia-list").innerHTML=html;

document.getElementById("stat-total").textContent=assignedJamiaat.length;
document.getElementById("stat-done").textContent=done;
document.getElementById("stat-pending").textContent=assignedJamiaat.length-done;

const percent=assignedJamiaat.length?Math.round(done/assignedJamiaat.length*100):0;
document.getElementById("stat-percent").textContent=percent+"%";
}

function renderJaizaTable(month){
let html="";
completedReports.forEach(j=>{
html+=`
<tr class="border-b">
<td class="p-3">${j}</td>
<td class="p-3">${month}</td>
<td class="p-3 text-green-600 font-bold">Submitted</td>
</tr>`;
});
document.getElementById("jaiza-table").innerHTML=html;
}

window.switchTab=function(name){

["overview","jaiza","test","tadris"].forEach(t=>{
document.getElementById("tab-"+t).classList.add("hidden");
});

document.getElementById("tab-"+name).classList.remove("hidden");

document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("tab-active"));
event.target.classList.add("tab-active");
}

window.handleLogout=()=>signOut(auth);

const now=new Date();
document.getElementById("report-month").value=
now.getFullYear()+"-"+String(now.getMonth()+1).padStart(2,"0");

document.getElementById("report-month").onchange=loadInspectorData;
</script>

</body>
</html>
